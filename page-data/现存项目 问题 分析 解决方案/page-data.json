{"componentChunkName":"component---src-templates-blog-post-js","path":"/现存项目 问题 分析 解决方案/","result":{"data":{"site":{"siteMetadata":{"title":"银凤梨"}},"markdownRemark":{"id":"0b2b04e6-bcca-542a-89df-b45d7cf3279c","excerpt":"在这里对在工作中的项目中代码，编码模式进行集中吐槽, 分析, 并提出各类解决方案的成本， 优劣点. 基础设施 svn 项目管理, 没有分支, 所有人都在同一条主分支上开发. 这种线性的开发模式导致敏捷开发的循环被各种环境打破, 开发代码和生产环境代码常常混杂在同一个主分支中, 导致迭代的周期被固定, 已上线的 bug…","html":"<p>在这里对在工作中的项目中代码，编码模式进行集中吐槽, 分析, 并提出各类解决方案的成本， 优劣点.</p>\n<h2>基础设施</h2>\n<ul>\n<li><strong>svn 项目管理</strong>, 没有分支, 所有人都在同一条主分支上开发. 这种线性的开发模式导致敏捷开发的循环被各种环境打破, 开发代码和生产环境代码常常混杂在同一个主分支中, 导致迭代的周期被固定, 已上线的 bug 难以 bugfix, 因为能不能上代码的问题,加大同事间沟通成本, 降低效率. 虽然, 公司正在逐步迁移到 gitlab 中, 但是, 也存在一定的问题. 首先, 没有统一的 gitflow, 一部分的项目和 svn 时期一样, 只有 master 一条分支. 大部分项目用的是 gitlab flow, 多少也算是一种进步. 第二, 以往的 svn 记录并没有保留下来, 对于这一点我是相当疑惑的. 只要稍微有些常理也知道如果没办法保留 commit 信息, 那迁移的成本是不是太高? 稍微搜索一下就会有解决方案. 我是没看到除我以外有人在迁移的同时花些时间考虑一下保留 svn commit.</li>\n<li><strong>代码质量管理方案欠缺</strong>, 以前是完全没有代码质量管理. 近期才添加了 eslint prettier 的支持. 但是…很可惜, 大量代码已经因为前期的质量方案问题, 已经造成代码风格百花齐放的局面, 要么忍受各种飘红的错误信息, 要么直接把 eslint prettier 关掉. 代码质量这东西, 我个人认为是非 0 即 1 的, 今天你能忍受一条错误, 明天你就能忍受第二条. 只能说, 终吃了基础设施落后的恶果, 现在要弥补这个缺陷, 可以抽个时间用 eslint fix 直接跑一遍, 将所有错误信息全部先 fix 掉, 但是这是不太可能的. 以现今代码项目规模来看, 大概有 10%(估算而已)的代码是需要人为修复, 不管怎么看, 这个代码量都太大. 另一种可能就是引入 lint-stage 的方案, 只对新提交的代码进行质量检测. 这个方案落地我是比较看好的, 虽然对我来说, 这个项目有没有质量管理, 其实都好像没太大意义. 对我而言, 这个项目重写的效率大于重构.</li>\n<li><strong>打包策略</strong>, 已知使用 gulp 打包 js, postCSS 编译 CSS. 没有好的现代打包机制, 直接影响整个前端基础设施的进步. 现代 bundler 如 webpack, rollup. 都是依赖模块化进行打包的. 而 gulp, 则天生不是用来打包 module like 的 JS 的. 要转换到 webpack, 就必须转向模块化. 这个迁移成本其实在我看来是可以接受的. webpack 和 rollup 都是入口导向的, gulp 则是以文件导向的, 其实两者转换并没有那么困难. 在以往的经验中, 这种迁移并没有很难, 在内部也有成功的先例.</li>\n<li><strong>社区建设</strong>, 以往社区的缺失直接导致工程师间交流出现障碍, 大家都闭门造车, 反复地造轮子, 浪费人力. 对于造轮子, 我一向是持保留意见的. 自己通过造轮子, 了解技术原理可以. 但是在有现存成熟方案的前提是, 自己搞一套上生产环境, 我觉得是一种非常不负责任的表现. 我非常不赞成工程师搞一套只能解决现状, 没有充分考虑未来变化的方案大干快上. 闭门造车的结果就是维护困难, 扩展困难, 迁移困难, 这些都是血一样的教训.你要知道工程师遇到的大部分问题都是别人遇到过的, 最起码, 你得知道别人是怎么解决问题, 站在巨人的肩膀上看问题, 解决问题, 才是一个工程师合格的修养.</li>\n</ul>\n<p>社区缺乏的现状稍微有些减轻, 因为有 gitlab 存在. 但是工程师的开源项目经验太少, 没办法在内部推广自己的轮子. 这点确实是工程师经验的不足, 也是氛围的问题. 在未来需要持续改进.</p>\n<p>我司一直在谈如何提升人效的问题. 其实加大对基础设施的投入, 也不失为一种高性价比提升人效的方法. 以我的经验, 最应该先做的是打包策略和 git 接入, git 接入成本会更高一些, 主要体现在 diff 和 commit, 未来维护的成本和沟通成本会有所降低. webpack 则是目前现代化前端的发动机, 有了 bundler, 对目前很多问题都可以更有效的解决, 这里列举一些</p>\n<ol>\n<li>esnext 支持, 支持更高标准的 JavaScript 语法.</li>\n<li>treeShaking 减少代码体积.</li>\n<li>更方便引入私有库和额外库, 减少重复造轮子, 更好地维护依赖关系.</li>\n<li>代码静态分析, 减少各种依赖错误.</li>\n<li>更现代, 更快的编译, 更短的压缩代码时间.</li>\n<li>引入测试框架.</li>\n<li>更好的应对未来升级.</li>\n</ol>\n<p>上面提到的这些, 其实都是现在主流的前端构建方案. 新进来的开发, 多少都有共识, 就是现存的工程化实在是太久了. 以上这些问题的解决方案, 有些我们已经在做了, 但是还做的不够好.</p>\n<h2>代码质量</h2>\n<h3>CSS</h3>\n<ul>\n<li><strong>随意的命名规则</strong>, 在各个项目中, 命名规则基本是 pascal, snake 等混用, 对怎么命名其实是没有太大约束力的, 这一点, 其实也没什么所谓.</li>\n<li><strong>缺失 CSS scoped, 大量覆盖性代码和重复代码</strong>, 这个问题是迄今为止我觉得 css 管理中最严重的问题. 为了大量互相覆盖的 css 代码,我们必须写更多的 css 代码去覆盖. 结果就是, css 越写越多, 换个环境, 瞬间就不一致, 因为你不知道到底原来引用了哪里的 css, 也不知道需要覆盖什么 css, 所以每次都需要直接复制一份在此基础上继续改, 进而使 css 代码量增加, 最后变成一坨意大利面, 越来越难维护. 这个问题.</li>\n<li><strong>过量的 CSS hack</strong>, 以前是为了兼容旧的浏览器, 所以必须要 hack. 但是现在已经不需要再兼容远古浏览器了, 兼容版本基本都是 ie9 起步, 过量的 hack 其实让 css 的正交性, 局部性, 可预测性都出现非常多的问题. 有时候有些 css 代码, 不知道有什么用, 但是又不敢删掉. 扩展起来, 又让人莫名其妙. 比如, 有时候应该用 flex 布局的地方, 各种用其他 table, grid, float 之类的 css 方法, 强行布局. 我觉得到了这个年代, flex 是已经可以不假思索直接就上的.</li>\n</ul>\n<p>要解决 css 问题, 最好的方法还是引入有效的具有 css scope 属性的 css 集成方案, 比如 scoped css 或者 css module.类似 BEM 的方案, 其实我是不太看好的. BEM 并不是一种强制性规则, 对于写些简单 css 的后端工程师是一种负担, 即便对于有经验的前端工程师, 完整的 BEM 规则也显得非常多余, 间接提高工程师的心智负担. 在我司全面使用 vue 的环境下, 我觉得 scoped css 就是一个不错的选择</p>\n<h3>JS</h3>\n<p>先说一下现状，目前基本上所有的项目，都已经做了工程化的处理了。jzallsite，site，mobi 使用了自己编写的 jz-cli 的打包方案，mallapp 的方案暂时确定是 vite。</p>\n<ul>\n<li><strong>全局变量管理</strong>, 这一点是我觉得比较大的历史遗留问题了。现代前端工程师都知道，如果你要在代码中引用一个外部变量，你应该直接 import 这个变量，而不是将这个变量做成全局变量，然后在项目里肆意地引用。目前所有项目基本都有这个通病，大量地在顶层创建全局变量，然后再在其他地方引用。比较常见就是 SIte，MallApp，Mobi 全局变量。我在做 mallapp 工程化的时候就发现一些代码在无意间创建全局变量的。例如在顶层调用<code class=\"language-text\">var variable1 = 1</code>，或者更夸张，在某个地方在变量还没做声明的时候直接调用<code class=\"language-text\">variable2 = 2</code>，这样的隐式全局变量声明，具有非常大的隐患。</li>\n<li><strong>跨 iframe 调用脚本</strong>，这种模式在 jzallsite 和 mobi 两个项目中非常常用，因为这两个项目在一个页面中至少会有 1 个 iframe（其实所有人都知道这是一种反模式，但几乎没人求变）。在里层的 iframe 经常会调用外层的页面的代码，这是一件非常违反代码松耦合原则的一件事，同时也是非常不可控的。</li>\n</ul>\n<h2>Common 通病</h2>\n<ol>\n<li>svn base 项目管理, 没有分支, 所有人都在同一条主分支上开发, 极度残忍. 没有 code review 也不需要, 因为没有分支合并.</li>\n<li>代码没有 format 直接提交, 这点尤其无语, 经常打开文档会出现空格, tab 混用的代码, 代码一长一短的, 实在寒心.</li>\n<li>global css 落后 gulp 打包. 全局污染非常严重.</li>\n<li>js 依然有落后 gulp 打包, 全局变量特别多, 依赖打包顺序. 按道理模块规范何其多, 但我们任性一个也不用.</li>\n<li>过于简单的 workflow, 没有讨论的空间, 不需要 review, 基本我提交项目就照单全收.</li>\n<li>iframe base 调优困难, 重复引入依赖.</li>\n<li>没有调优的概念, 能用就行.</li>\n<li>重复造轮子, 造劣质轮子直接用于项目. 为什么不优先考虑行业成熟方案.我觉得是看的少, 不知道有成熟方案.</li>\n<li>也是因为自己造轮子, 特质化, 没有标准. 引入方案困难.</li>\n<li>没有注释标准. 反正想怎么写就怎么写, 更多的是直接不写, jsDoc 了解一下?</li>\n<li>大量 hard coding, 纯手写 url, 不会用变量来管理吗\\</li>\n<li>css 命名混乱, 有使用 camelCase 的, 有使用 snake 的, 有使用 underscore 的,</li>\n</ol>\n<h2>Mobi</h2>\n<ol>\n<li>粗暴迭代, 直接创建新文件</li>\n</ol>\n<p>请看新时代 coding 风格, 面向复制新文件的编程风格. 需求风格 2.0 => 3.0 直接每个模块复制一段新的代码到 xxxV3.jsp.inc. 跟接着同样新赠 xxxV3.src.css, 维护水平指数上升, 极具文艺复兴特质. 在代码中到处可以看到 if(…ThemeV3) 的代码复用字样. 估计也是因为 2.0 代码太捞, 没办法实现 3.0 功能. 另 3.0 的主开发已经离职, 牛逼. 所以直接搞一套新的.虽然我目前写的代码也是面向复制新文件. 后面会再说到.</p>\n<ol>\n<li>文艺复兴系列之 jquery</li>\n</ol>\n<p>大量代码逻辑依赖 jQuery, 依赖于视图层. 就问你敢不敢动 dom 结构. 我感情 5, 6 年前没有 vue react angular. 前端的框架不是还有 ember 之流? 怎么想到直接一把梭子就是干?</p>\n<p>给各位欣赏一下面向 jq 的响应式编程</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7c99291e6512f7d6ab9072d97c869b39/38cea/image-20200821165327699.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.43243243243244%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACv0lEQVQ4y42U6XKbMBSF/Rw1m1YkAcb7lrhJO9O+/xudngskdRLc6Y87whgd3eU7Wmit0IQah7bGLnlEq9EHh1106BuPtbyLHilGVK6BqlvoukGeZyiKAkWej+sUi5wvrDN4vbZ4XkXc+ganVY3nc4fXW4cmam6Wj/Mhcm7Kp835JCbrWyzkY200zvvIrDwOTUBfG+y2AU88xJkc35YZskxiiZxrLuud2IcMrfPoYoNgFcs1sKpC4AGJz57lB4bVGrW3rCSgNDW0Tygr9UVsEFQUSLHGjxNL7hP2TY1TG3DbN7geG+w6Nwh6tsXYmoIeykWUZTUvKKVUusLlEIdBiNg6GBwp9nRJMLrAMrsvefml5HvhRaUMQh2wXXlsON118GiZTd957HeJZZecZMGMJPh8H/M9dFjFhE20Ay6W2bbs17q2iLImrtbyUIcmpQmdjuikecHP2Egf37B5eR6x+dyn+5gVFGyux4QDIT61kWVbHPYJNwo6K9jkUw+zv9jIOoPOgE0bEmoz4mI4da/V4BjP3zVxsophZNIOpXaoiE5l3HyGih+3KeCV2NwEm0RsOmKzTZx8g0PveZiGczI8EQrEJkFZPy84YqNwnbA5CjYc0JFil3OcsBlLXv5PyUK8Z9nbfsRmyww7T2yI0Yks1q4cBO/9KhfDQ+tpTYsZyxPHPyQL4a4QEYYib5qHGqOgyGxR6bF/j5wi1msm64099DhvIn5/32C/cnDssTMGkdk7slfaCB26x14ueaK1vPvo2Y4grwTooLHdRgRfvZebDRlnY7nZP0p2Ti7SZhjEmlkIMi1F5ZJI7KXcOsGJSzw8MxOnmLRGpfR8hkVRwnmHl0uLK51yITKHTcCvn1tsOj1kNvq4mPz72Mfvl4OuzOiCuzIymWbxebofY7bksirQnQK6Y4BvzPu0H2XwLx9L/AHr9VCgZIxlXAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200821165327699\"\n        title=\"image-20200821165327699\"\n        src=\"/static/7c99291e6512f7d6ab9072d97c869b39/fcda8/image-20200821165327699.png\"\n        srcset=\"/static/7c99291e6512f7d6ab9072d97c869b39/12f09/image-20200821165327699.png 148w,\n/static/7c99291e6512f7d6ab9072d97c869b39/e4a3f/image-20200821165327699.png 295w,\n/static/7c99291e6512f7d6ab9072d97c869b39/fcda8/image-20200821165327699.png 590w,\n/static/7c99291e6512f7d6ab9072d97c869b39/38cea/image-20200821165327699.png 678w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/36a45626b682094408fa6fb8019b356f/cab43/image-20200821165405251.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABxklEQVQoz21S6Y6bMBjMgwAJhw8wPiGQpN2oUXfVff8Xmo4dpe1K/TGyP9uM5uBg0g3pxyfm7YYQLPYlYbMTJiXQHI+o6wZHrsfTiWh5luem3D3B87Z93nM+CKnhlivC7QH/7YH1+h3BB0xGY54NjIsYtIEwDmI0kONEaAxq5Hnem3Lfk2cQPQ51XaGpKuhxhtvvRalLC6K3CM7ChgQXIvTs0QtRCAr5ZCFIKKQsiuu6RkWew1N2g1FOVPcTy+MT675j2y5IziCFgO32BmUjZAajGI2FDmfIOUBlaImmORbSQ9M8M9FCI5zfEO/vCOsZy7LCmRHee6TzFdoGKvMQSkKTULkESaWSSrPVTPaFUPYSNu6wlzttRhYU4SYNM00IceGHMzrm1vctrTI/EvVqIrgf/iGsmxpD12NkhtnSwMdSKSg+ElJR0VhyavsBXdeiGxTaIc8CbdcVMVVVIwv7q5DQbMrnUmjPxQTPQpwlPJVSYSlB6aIu2yz2WVAvSN6evlpuSoYjYsnwg+uGdd0Q+T8GZrjutz8ZSinYODP0jCHPzDOf/ZcwXR78yX8hbRs2FhPnCTFkwlcprthXVJZLyapfpbws/wawESd7AU97hAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200821165405251\"\n        title=\"image-20200821165405251\"\n        src=\"/static/36a45626b682094408fa6fb8019b356f/fcda8/image-20200821165405251.png\"\n        srcset=\"/static/36a45626b682094408fa6fb8019b356f/12f09/image-20200821165405251.png 148w,\n/static/36a45626b682094408fa6fb8019b356f/e4a3f/image-20200821165405251.png 295w,\n/static/36a45626b682094408fa6fb8019b356f/fcda8/image-20200821165405251.png 590w,\n/static/36a45626b682094408fa6fb8019b356f/cab43/image-20200821165405251.png 755w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>\n<p>面向拼接字符串的前端模板编程.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d33d2cff71e8a9084d82d9975424d88/cab43/image-20200821165418036.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABmElEQVQoz41SSZLbMBDTO2JJ3ERSXCTbkjPxTFKVQyq3/P87CJqSL5lLDijuaDTAbtQO8/aB/dcf5P2J+vyJ9cdv5NsG6wyGYcQ4/j864zz8nOGdRfIknxxK8FhiQOZaK4VLP6AfBpL/g77/tNf5suL69gEzDghUtOeIb3XG9zXjnZACkfuRBZ3RmE5Y6+DmAjN5WK0QrMFkNToXM8pthyLhF1aUg3sKWKPHc0l4nAXuKSKRXFTPJPchYr4+4GJqBWuY2lk35QXr4wlNQqVGXGffsPCCEBdeEuSJJEaUnAqpzNcbrI/c162YdNFNlF23N6ihb6Yu8SDaBFQnvm5lxloylrog0Vvf2jPQWn8OpRHeH02hBJBeigghl/mjpkaYS4VzrnkpUCSQYPrL5RgllNby16NlIdhLbCQ1OIZkWxGBoR3ShWMAjsokCIGWcJiDkZHrzvHLFCpUZLe8KCGIh+KJFEj0rjIgMT2cSQvsSaqMaT5qY9u6pZyvGwINL3zkeEEUvRQYmZvjsexLWy+8/l7fs+Xh+JN/AV/EHH0DWu1YAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200821165418036\"\n        title=\"image-20200821165418036\"\n        src=\"/static/5d33d2cff71e8a9084d82d9975424d88/fcda8/image-20200821165418036.png\"\n        srcset=\"/static/5d33d2cff71e8a9084d82d9975424d88/12f09/image-20200821165418036.png 148w,\n/static/5d33d2cff71e8a9084d82d9975424d88/e4a3f/image-20200821165418036.png 295w,\n/static/5d33d2cff71e8a9084d82d9975424d88/fcda8/image-20200821165418036.png 590w,\n/static/5d33d2cff71e8a9084d82d9975424d88/cab43/image-20200821165418036.png 755w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n</ol>\n<p>我丢, 即便上个年代上模板引擎他不香吗. pug, handlebar, 那样是上个年代没有的, 即便在 java 端也有相应的模板引擎. 你直接给我 srcipt.append 是要玩什么? 拼接模板就拼接模板吧, 你能不能对齐? 来看看各种风格</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1bec3658d25af8f709fba7cb34dd3c23/7527b/image-20200821165527744.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABlklEQVQoz42SyY7UQBBE/R20l9r3sntsQzdixAGJG///O0Fmjgch5sIhVapy+WVEZA2zskjHNxw/fqEcT/Tnd6yvP1HuO4zVmKYZ8/z/NWjn4VOBtwbZE9xZlODRo0ehvVoW3MYJ4zQR/J8axw9ng693bF++Qs8TAik6S8SjRbxuBc+epUGkc/5mtYK7yhgLmypYkFELgtHwRmHgw0r2FqJ/oo6BlL7kgC15PHrCWblBorOIzOrZBcF9SEjbCRszIsFacPJtcGXFej6gSOFC9hi0Ri6HO4ErXWrBEszA60sJK+So2gYbouyzODEEzB19/0wKRwmVYaxw5yL7nOteE9Za0FtDDgGOoE5raKU+DsXlhvpyiEIeAMvmYmWsktezZWyVomkd1lrJkmtZZhnMeLu9rTIUsfwUYCfAQaqK2HSSJzfRUrO4sDQAQ8qMrAuUNpKjtk7211AOucwXecqcI0M7QTk7fkL1avCuzl7QhYDGR2ia+h9g2XYJnH+ylA2relegeeUhEIDP2dbfxW9vHMny9PYmfwN2MRyQ5vEB1QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200821165527744\"\n        title=\"image-20200821165527744\"\n        src=\"/static/1bec3658d25af8f709fba7cb34dd3c23/fcda8/image-20200821165527744.png\"\n        srcset=\"/static/1bec3658d25af8f709fba7cb34dd3c23/12f09/image-20200821165527744.png 148w,\n/static/1bec3658d25af8f709fba7cb34dd3c23/e4a3f/image-20200821165527744.png 295w,\n/static/1bec3658d25af8f709fba7cb34dd3c23/fcda8/image-20200821165527744.png 590w,\n/static/1bec3658d25af8f709fba7cb34dd3c23/7527b/image-20200821165527744.png 754w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/060268011afb8e4532229126b3df75cf/cab43/image-20200821165543016.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACaklEQVQ4y2VUWY7bMBSbY0wSb1qtzVuSNtMpWqBA738llk92OgPMByHp2X6iSMov1lpYaxBiRp4XpBiQRo8UAvZnH3DOY9uumKYJKSWUUjhm1h2cFVi8tG0HozW6YUDXEW2D5nJB0zQ4c7wQ5/O5Quan11ecTqejdmLtXN+VZ/2g8NK1LbxPuP3+i+vtCksWU4pYUsCWEzLZTusV83Yj+4goIHvvPWyI0NZDk4zXCsE7Nuw6DCzEecP6eOOxJwQe48pxLpkouK4rtmXFytq6LNi4Ltx04oYjGwejkZ2u0v1v6GysTWOJMGMikwQ79LCqhydk7r6MQ4UmOxOoJX2oDbVxGKcVMWdY7uaIvhdNuy/oD3yutZSt63p0fb9r6Kjh8v4H27c7DaLjRiGR/uQtkuOac01GAnWMhswEtaYUFEkN2uwNB22Rb2+Yl1wdz2wU2UiaRasxEmYYqvh744FS7JC64jfS0LhxbyiL+fEL1/tSG06jQyGm0VaWwtBRJ6v3JuLoyFNITWBG6u4DmeqnKQo9affU4KnLpWlxlixKxoiGa6ntY1PndU1CbcO8MpPyHRl2NYfl/o6ZcQjMoewqUfBmZyJzd7Cqa5FBnrOmRT8e1ZelZrIyTI55Wx+YGezM4Ioh+dBPdJS5NJB5sgrF7zVZe9YVj5vuPxj0csRGO8TlhpzD8aGu2s3UsPhdx3I4XtJ+e56bCEtjqHOaeMs+mVK+/8S6FgSaMh9GRDkqTZAjC1thI4GXn8DTZZFFRjd0NQGVoWPDhX+QlVdtmWesnAe6nDK1IaPAW6Bo2EC08vOgKRLmD3S1psj0HzJsqtK4/c9PAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200821165543016\"\n        title=\"image-20200821165543016\"\n        src=\"/static/060268011afb8e4532229126b3df75cf/fcda8/image-20200821165543016.png\"\n        srcset=\"/static/060268011afb8e4532229126b3df75cf/12f09/image-20200821165543016.png 148w,\n/static/060268011afb8e4532229126b3df75cf/e4a3f/image-20200821165543016.png 295w,\n/static/060268011afb8e4532229126b3df75cf/fcda8/image-20200821165543016.png 590w,\n/static/060268011afb8e4532229126b3df75cf/cab43/image-20200821165543016.png 755w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ce57df9c0c463f71e915e7799df91ab2/17a7a/image-20200821165446947.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB50lEQVQ4y4VTWXbjMAzLOSZeZGuxZHmLneS1vf+9WIKSUs+08/qBB5mOKRBELtP2pPX5Qdvjne7HjebZU1gW6rWha1VRVdeCOvMZdUbTNC++tErRGGd6Hgdt3tHC2MeBJmfIm14w6I50p4QDP4dcN1w7N5OGcuBCr1qaB0N7cPSMnj6WQAc3jlZLHRcAy2CFne5Jte3PDdvygrF5Sxs3neVjI883Bi7CeXaaVq7jkjaLKc3+aghgrBt/OLIq23fkGKrnc1xJjzPZaRM21sr4+ObsL/jVEAWMd4+DKDtGJ8oiK4XiffS0sr+3MLA6KyO7fCm8hADTq9QQXsDksggo1bws+NoxtGpzLTHqvdTV6xln/PaicOjQPY1wrWr6w3G5CurMHJ/T+Xp6/33kluX6iaZtp+A9e5MiUUbASLZPKsCOvRsydI7ND0tpyPMP4Bmi8jYHic3OPgb2Fd4Gkxi2RJeWBqtEXfUV8NdS6syIRwE2vvICDuYHLwuLklhllHBjqpLnb7G5j4NkTEZnGMOLmlca4kJ+WjlCCzk/UtCdqEQWu6L039iMPNYjIh42xYaVSWw4MnsMtAawl78nLMCFydsSHfXVEIqKsi7HAqxaKGjSc2F5nxYFHwsDF0RGd2lr6pT8/+G39585i6YVZ9U4SAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200821165446947\"\n        title=\"image-20200821165446947\"\n        src=\"/static/ce57df9c0c463f71e915e7799df91ab2/fcda8/image-20200821165446947.png\"\n        srcset=\"/static/ce57df9c0c463f71e915e7799df91ab2/12f09/image-20200821165446947.png 148w,\n/static/ce57df9c0c463f71e915e7799df91ab2/e4a3f/image-20200821165446947.png 295w,\n/static/ce57df9c0c463f71e915e7799df91ab2/fcda8/image-20200821165446947.png 590w,\n/static/ce57df9c0c463f71e915e7799df91ab2/17a7a/image-20200821165446947.png 753w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>实在是让人赏心悦目</p>\n<h2>Qz PC &#x26; Mall PC</h2>\n<ol>\n<li>\n<p>引入整个 antd bundle</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/054f1e337d0f5c357710e8e0c6f5754c/a4262/image-20200821165606271.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACbklEQVQozzVT2W7bMBD0//9PWzQt0JxN4jPxIduND9k6KEriIUpW5ADNdCSjD4PdHXJJ7s6yV5sp5PERedRHFg6Qhn2oeIw0uMTJsY/I7yPYPkIGQ+4bcP8T15+R+G0euXiCJByjqfboVdrj5gcU2QxOLWHSOWy2uNh8AZ3OoOQMuZiSn6NUlzVDvkWRe5c489CUOx5op4h2d3xVH1qMeNsARk5oh1Bi2L1YhkPEhyeohOtigCxuOb4yfOZDXslPkIkXfNQ+eqfDFPHbEFYsUaRvsMkfWHmxRqyh4xVUtIQNPZTBAnVE2/rkHNccczT9nNxJseQyFBBBBBHGRITQPxIHRIcAqZBI4wQ616hNAVQnoG6A5gOf5Qln69i3muUq5DJD7SoeqOeQYsXkJSRvF+G8Qxsn4ayDTtco7R5G+7DGR2EOUPkOKtsiTzdQhGF8fpfo1QUP6vrU9mbE5ClSKucUmy4ZJ0Ni1HFpNIKg6vGRCnO/4CSIYMBqGNP/eKcodcoEjo1lg0/yBRUb7ChIiyK6wPGiE5WvMvZNLlCm7GG66PwiofK0jV7h021Y8vonkskVxPgb1OwK2eQL8pev0LPvMPMfKNc3MN417OoOZnkPtbiB9m472NV9Z/PZL9jNb5zHV1Q5fIDZcYGjU/gPsHv629sOanNNe9PBsTTH4TWHAWwwgj2yMvoFuTKaoE5e8Vd5LLncw+otnN110Nm6s5XboyzImQ0FYVz4aBqJho1v7fm//57AuYBiHcgnfKGlSsLjxHPu5IoD3f6CFX/EBpXZ4kR1nXpDxUsrvWG8Q0mlVbqlsvvOBv68w6kI8A9PJW6Zz+Bn1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image-20200821165606271\"\n        title=\"image-20200821165606271\"\n        src=\"/static/054f1e337d0f5c357710e8e0c6f5754c/fcda8/image-20200821165606271.png\"\n        srcset=\"/static/054f1e337d0f5c357710e8e0c6f5754c/12f09/image-20200821165606271.png 148w,\n/static/054f1e337d0f5c357710e8e0c6f5754c/e4a3f/image-20200821165606271.png 295w,\n/static/054f1e337d0f5c357710e8e0c6f5754c/fcda8/image-20200821165606271.png 590w,\n/static/054f1e337d0f5c357710e8e0c6f5754c/a4262/image-20200821165606271.png 814w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>明明在 console 已经说了不要引入整个 antd 包, 但是依然整个包引入了. 公司原本使用自己的组件库, 貌似放弃了, 转而使用 antd-vue 了. 之后应该自己魔改了. 不过看了看 antd-vue 的代码貌似是全程使用 render + jsx. 这魔改难度略大. 毕竟这个 antd-vue 的版本就是 antd 魔改出来的.</p>\n</li>\n<li>\n<p>全局风格</p>\n<p>全局风格的实现在我看来也是相当下饭的操作. 使用内联 style 的架构. 风格效果全靠覆盖. 怎么, 大家是没听过 css-in-js 还是咋地. 以后每新建一个模块都要使用 window.globalcolor 来设置颜色和其他东西. 我谢谢你.</p>\n</li>\n<li>\n<p>没有使用任何 state management 框架, 改数据全靠在全局变量上改.</p>\n<p>我…都上 vue 了, 上 vuex 能把你咋地. 导致代码耦合已经相当严重. 到处都引用全局变量卧槽. 当然在其他项目这个也中招了. 数据保护不存在的, 想怎么改就怎么改.</p>\n</li>\n<li>utils 只有一个文件, 目前已超过 10000+行. utils 和 api 全放这了, 这个文件能不大? 另外作为 utils 函数你不注释, 你是写给自己用的吗</li>\n</ol>\n<h2>Qz 小程序</h2>\n<p>迭代有些问题, 版本管理不是很明确, 这玩意在手机中常常会占用非常多的内存, 常常一打开就飙到 600m+, 要知道小程序的上限貌似只有 1G. 没仔细研究过代码, 按道理说不应该能占用这么多内存的. 可能是因为大量的 component 创建导致的. 另外需求也是不是很合理, 例如视频列表, 地图列表等, 其实是不应该可以插入多个这样的模块的. 这个项目 api 编写不是很规范, 而且里面有些异步代码没有回调, 没有考虑到连锁的异步场景, 典型的是登录的模块, 代码那是比较不科学. 状态管理的缺失也导致我开发全局订阅事件这样的库. 里面很多黑科技. 不过在公司众多项目中代码算是比较中规中矩了.</p>","frontmatter":{"title":"现存项目 问题 分析 解决方案","date":"October 26, 2020","description":""}}},"pageContext":{"slug":"/现存项目 问题 分析 解决方案/","previous":{"fields":{"slug":"/Miniprogram Transformer Review javscript parser 应用/"},"frontmatter":{"title":"Miniprogram Transformer Review: javscript parser 应用"}},"next":{"fields":{"slug":"/svg优化及相关思考/"},"frontmatter":{"title":"svg优化及相关思考"}}}}}